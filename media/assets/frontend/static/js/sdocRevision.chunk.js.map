{"version":3,"sources":["pages/sdoc-revision/index.js","components/common/go-back/index.js"],"names":["window","app","config","serviceURL","avatarURL","siteRoot","pageOptions","username","name","sdocRevision","repoID","fileName","filePath","docUuid","assetsUrl","fileDownloadLink","originFileDownloadLink","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocRevision","props","edit","event","stopPropagation","nativeEvent","stopImmediatePropagation","location","href","publishRevision","seafileAPI","sdocPublishRevision","then","res","origin_file_path","data","catch","error","errorMessage","Utils","getErrorMsg","toaster","danger","gettext","renderContent","state","isLoading","revisionContent","originContent","className","currentContent","lastContent","fetch","json","setState","this","classnames","color","onClick","React","Component","ReactDom","render","document","getElementById","GoBack","onBackClick","preventDefault","history","back"],"mappings":"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","file":"static/js/sdocRevision.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport classnames from 'classnames';\nimport { Button } from 'reactstrap';\nimport { DiffViewer } from '@seafile/sdoc-editor';\nimport { gettext } from '../../utils/constants';\nimport Loading from '../../components/loading';\nimport GoBack from '../../components/common/go-back';\nimport { Utils } from '../../utils/utils';\nimport { seafileAPI } from '../../utils/seafile-api';\n\nimport '../../css/layout.css';\nimport '../../css/sdoc-revision.css';\nimport toaster from '../../components/toast';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl, fileDownloadLink, originFileDownloadLink } = window.sdocRevision;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocRevision extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      errorMessage: '',\n      revisionContent: '',\n      originContent: '',\n    };\n  }\n\n  componentDidMount() {\n    fetch(fileDownloadLink).then(res => {\n      return res.json();\n    }).then(revisionContent => {\n      fetch(originFileDownloadLink).then(res => {\n        return res.json();\n      }).then(originContent => {\n        this.setState({ revisionContent, originContent, isLoading: false, errorMessage: '' });\n      }).catch(error => {\n        const errorMessage = Utils.getErrorMsg(error, true);\n        this.setState({ isLoading: false, errorMessage });\n      });\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      this.setState({ isLoading: false, errorMessage });\n    });\n  }\n\n  edit = (event) => {\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    window.location.href = `${siteRoot}lib/${repoID}/file${filePath}`;\n  }\n\n  publishRevision = (event) => {\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    seafileAPI.sdocPublishRevision(docUuid).then(res => {\n      const { origin_file_path } = res.data;\n      window.location.href = `${siteRoot}lib/${repoID}/file${origin_file_path}`;\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, false);\n      toaster.danger(gettext(errorMessage));\n    });\n  }\n\n  renderContent = () => {\n    const { isLoading, errorMessage, revisionContent, originContent } = this.state;\n    if (isLoading) {\n      return (\n        <div className=\"sdoc-revision-viewer h-100 d-flex align-items-center justify-content-center\">\n          <Loading />\n        </div>\n      );\n    }\n\n    if (errorMessage) {\n      return (\n        <div className=\"sdoc-revision-viewer h-100 d-flex align-items-center justify-content-center\">\n          {gettext(errorMessage)}\n        </div>\n      );\n    }\n\n    return (\n      <DiffViewer\n        currentContent={revisionContent}\n        lastContent={originContent}\n      />\n    );\n  }\n\n  render() {\n    const { isLoading, errorMessage } = this.state;\n\n    return (\n      <div className=\"sdoc-revision d-flex h-100 w-100 o-hidden\">\n        <div className=\"sdoc-revision-container d-flex flex-column\">\n          <div className=\"sdoc-revision-header pl-4 pr-4 d-flex justify-content-between w-100 o-hidden\">\n            <div className={classnames('sdoc-revision-header-left h-100 d-flex align-items-center o-hidden')}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            <div className=\"sdoc-revision-header-right h-100 d-flex align-items-center\">\n              {(!isLoading && !errorMessage) && (\n                <>\n                  <Button color=\"success\" className=\"mr-4\" onClick={this.edit}>{gettext('Edit')}</Button>\n                  <Button color=\"success\" onClick={this.publishRevision}>{gettext('Publish')}</Button>\n                </>\n              )}\n            </div>\n          </div>\n          <div className=\"sdoc-revision-content f-flex\">\n            {this.renderContent()}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocRevision />, document.getElementById('wrapper'));\n","import React, { Component } from 'react';\n\nimport './index.css';\n\nclass GoBack extends Component {\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return (\n      <div className=\"go-back\" onClick={this.onBackClick}>\n        <span className=\"fas fa-chevron-left\"></span>\n      </div>\n    );\n  }\n}\n\nexport default GoBack;\n"],"sourceRoot":""}